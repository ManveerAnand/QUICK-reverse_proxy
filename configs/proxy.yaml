server:
  address: ":443"
  cert_file: "certs/server.crt"
  key_file: "certs/server.key"
  fallback_address: ":80"
  quic:
    max_streams: 1000
    idle_timeout: "30s"
    keep_alive: "15s"
    enable_0rtt: true
    max_token_age: "24h"
    congestion_algorithm: "cubic"

backends:
  - name: "api-service"
    targets:
      - "http://backend1:80"
      - "http://backend2:3000"
    health_check:
      enabled: true
      path: "/"
      interval: "3s"
      timeout: "2s"
      healthy_threshold: 2
      unhealthy_threshold: 2
    load_balancer: "round_robin"
    weight: 1
    timeout: "10s"
    retry_count: 3

  - name: "web-service"
    targets:
      - "http://backend1:80"
    health_check:
      enabled: true
      path: "/"
      interval: "3s"
      timeout: "2s"
      healthy_threshold: 2
      unhealthy_threshold: 2
    load_balancer: "round_robin"
    weight: 2
    timeout: "15s"
    retry_count: 2

routing:
  default_backend: "api-service"
  rules:
    # API routes - goes to api-service (alternates between backend1:80 and backend2:3000)
    - path: "/api/*"
      backend: "api-service"
      priority: 100
      strip_prefix: false
      methods: ["GET", "POST", "PUT", "DELETE"]

    # Health check routes
    - path: "/health"
      backend: "api-service"
      priority: 90

    # Metrics route
    - path: "/metrics"
      backend: "api-service"
      priority: 90

    # Web routes - goes to web-service (only backend1:80)
    - path: "/web/*"
      backend: "web-service"
      priority: 80
      strip_prefix: true

    # Static files
    - path: "/static/*"
      backend: "web-service"
      priority: 70

    # Default catch-all route (lowest priority)
    - path: "/*"
      backend: "api-service"
      priority: 1

telemetry:
  metrics:
    enabled: true
    port: 9090
    path: "/metrics"
    collection_interval: "15s"

  tracing:
    enabled: true
    endpoint: "http://localhost:14268/api/traces"
    service_name: "quic-reverse-proxy"
    sample_rate: 0.1

  logging:
    level: "info"
    format: "json"
    output: "stdout"
